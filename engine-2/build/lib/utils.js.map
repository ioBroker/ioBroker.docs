{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/lib/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { DocHeader } from '../types';\n\n/**\n * Trim character from start and end of text\n *\n * @param text Text to trim\n * @param char Character to trim (default: space)\n * @returns Trimmed text\n */\nfunction trim(text: string, char: string): string {\n    char ||= ' ';\n    // remove leading \\n\n    while (text && text[0] === char) {\n        text = text.substring(1);\n    }\n    // remove trailing \\n\n    while (text && text[text.length - 1] === char) {\n        text = text.substring(0, text.length - 1);\n    }\n    return text;\n}\n\nexport function extractHeader(text: string): {\n    header: DocHeader;\n    body: string;\n} | null {\n    const attrs: DocHeader = {};\n    if (text === undefined || text === null) {\n        return null;\n    }\n    if (text.substring(0, 3) === '---') {\n        const pos = text.substring(3).indexOf('\\n---');\n        if (pos !== -1) {\n            const _header = text.substring(3, pos + 3);\n            const lines = _header.replace(/\\r/g, '').split('\\n');\n            lines.forEach(line => {\n                if (!line.trim()) {\n                    return;\n                }\n                const pos = line.indexOf(':');\n                if (pos !== -1) {\n                    const attr: keyof DocHeader = line.substring(0, pos).trim() as keyof DocHeader;\n                    if (attr === 'translatedFrom' && !['de', 'en', 'ru', 'zh-cn'].includes(line.substring(0, pos).trim())) {\n                        return;\n                    }\n                    (attrs as any)[attr] = line.substring(pos + 1).trim();\n                    (attrs as any)[attr] = (attrs as any)[attr].replace(/^['\"]|['\"]$/g, '');\n\n                    /*if (attrs[attr] === 'true') {\n                        attrs[attr] = true;\n                    } else if (attrs[attr] === 'false') {\n                        attrs[attr] = false;\n                    } else if (parseFloat(attrs[attr]).toString() === attrs[attr]) {\n                        attrs[attr] = parseFloat(attrs[attr]);\n                    }*/\n                }/* else {\n                    attrs[line.trim()] = true;\n                }*/\n            });\n            text = text.substring(pos + 7);\n        }\n    }\n\n    return { header: attrs, body: trim(text, '\\n').trimEnd() };\n}\n\nexport function extractLicenseAndChangelog(text: string): {\n    body: string;\n    license: string;\n    changelog: string;\n} {\n    const lines = (text || '').trim().split('\\n');\n    const changelog: string[] = [];\n    let changelogA = false;\n    const license: string[] = [];\n    let licenseA = false;\n    let newLines: string[] = [];\n    lines.forEach(line => {\n        if (line.match(/#+\\sChangelog/i)) {\n            changelog.push('## Changelog');\n            changelogA = true;\n            licenseA = false;\n        } else if (line.match(/#+\\sLicense/i)) {\n            license.push('## License');\n            changelogA = false;\n            licenseA = true;\n        } else if (line.match(/^# |^## /)) {\n            // if some other chapter detected\n            newLines.push(line);\n            changelogA = false;\n            licenseA = false;\n        } else if (licenseA) {\n            license.push(line);\n        } else if (changelogA) {\n            changelog.push(line);\n        } else {\n            newLines.push(line);\n        }\n    });\n    while (newLines.length && !newLines[0].trim()) {\n        newLines.shift();\n    }\n    while (newLines.length && !newLines[newLines.length - 1].trim()) {\n        newLines.pop();\n    }\n\n    while (changelog.length && !changelog[0].trim()) {\n        changelog.shift();\n    }\n    while (changelog.length && !changelog[changelog.length - 1].trim()) {\n        changelog.pop();\n    }\n\n    while (license.length && !license[0].trim()) {\n        license.shift();\n    }\n    while (license.length && !license[license.length - 1].trim()) {\n        license.pop();\n    }\n\n    return { body: newLines.join('\\n'), license: license.join('\\n'), changelog: changelog.join('\\n') };\n}\n\nexport function getTitle(text: string): string {\n    const result = extractHeader(text);\n    if (!result) {\n        return 'no title';\n    }\n    let { header, body } = result;\n    if (!header.title) {\n        // remove {docsify-bla}\n        body = body.replace(/{[^}]*}/g, '');\n        body = body.trim();\n\n        const lines = body.replace(/\\r/g, '').split('\\n');\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i].startsWith('# ')) {\n                return lines[i].substring(2).trim();\n            }\n        }\n        return 'no title';\n    }\n    return header.title;\n}\n"]}