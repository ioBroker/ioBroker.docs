---
title: Обновить NodeJS
lastChanged: 29.10.2022
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/install/updatenode.md
hash: oazpYy+PiXB6o3KoKB2y5HvacmA17vhc6tJYAJKDIyk=
---
# Обновление Node.js
| js-контроллер | Node.js | нпм |
| ------ | ----------- | ------------- |
| < 4.x | 12.х, 14.х, 16.х | 6.х |
| 4.х | 12.х, 14.х, 16.х | 6.х, 7.х, 8.х |

## Зачем вам это обновлять?
Как и многие другие технологии с открытым исходным кодом, Node.js быстро развивается.
Обновления, повышающие **стабильность** и **безопасность** или даже добавляющие **новые функции**, появляются регулярно.

ioBroker не работает без Node.js, подробности см. в [архитектура](https://www.iobroker.net/#de/documentation/basics/architecture.md).
Если вы хотите узнать больше о Node.js, [Википедия Node.js](https://de.wikipedia.org/wiki/Node.js).

?> **В случае изменения версии Node.js некоторые требования должны быть проверены и при необходимости исправлены заранее.
Важно отметить пути, по которым находится установка.**

### Метод
#### 1 - Проверить условия
- версия и путь
- операционная система
- js-контроллер
- Адаптеры

<details><summary>Почему это нужно проверять?</summary>

- какая версия и, прежде всего, в каком каталоге находится установка

- В среде Raspi часто используются более старые системы, основанные на «Debian jessie» или «Debian wheezy». Для них нет ничего выше Nodejs 10, при необходимости возможно обновление операционной системы.

- Проверить какая версия js-контроллера установлена (также видно на вкладке host в админке).

Для версий **до** js-controller 3.x, пожалуйста, сначала обновите js-controller, если это возможно. Лучше хотя бы на 3.2! Например, на форуме есть этот [вклад](https://forum.iobroker.net/topic/42385/js-controller-3-2-jetzt-im-stable).

- Чтобы убедиться в отсутствии несовместимостей или проблем после обновления, следует проверить все адаптеры в системе и при необходимости обновить их.

Лучше всего проверить readme адаптера через администратора, в журнале изменений или в GitHub соответствующего адаптера, чтобы увидеть, поддерживают ли установленные версии адаптера запланированную версию Node.js.

</детали>

#### 2 - Создать резервную копию
Прежде чем вносить какие-либо изменения в систему, необходимо создать резервную копию. В зависимости от системы есть разные варианты. Рекомендуется использовать адаптер BackitUp или команду командной строки.
Резервная копия должна быть актуальной, чтобы никакие данные не были потеряны.

#### 3 - Обновление адаптера
Используемые в системе адаптеры должны быть совместимы с новой версией Node.js, при необходимости их необходимо обновить.

#### 4 - Остановить ioBroker
ioBroker останавливается с помощью собственной консольной команды или управления системными службами

#### 5 - Проверить, запущены ли еще процессы
Обычно это завершает все процессы. На всякий случай следует еще раз проверить, действительно ли не запущены никакие процессы (адаптеры, резервные копии). Вы также можете использовать такой инструмент, как «top», чтобы проверить, есть ли еще процессы, начинающиеся с «io». Начало.

#### 6 — Обновление Node.js
Следующим шагом будет обновление Node.js до желаемой новой версии.
Однако обновление отличается в зависимости от установленной операционной системы, см. инструкции

?> Диспетчер пакетов Node, сокращенно `npm`, также обновлен, его может потребоваться сбросить до версии npm v6.x вплоть до js-controller версии 3, в зависимости от используемой версии Node.js. Начиная с js-controller версии 4, также поддерживается npm v7/8.

#### 7 - Проверить версию и пути
После завершения обновления пути и установленные версии снова проверяются.

#### 8 - Запускаем ioBroker fixer
Поскольку установка Node.js, как было сказано в начале, вносит некоторые изменения в систему, после этого необходимо запустить фиксер ioBroker.
Помимо прочего, это восстанавливает настройки безопасности, необходимые для работы ioBroker, а также проверяет и исправляет все авторизации.

#### 9 - Запустить ioBroker
Некоторые используемые модули JavaScript содержат части, которые необходимо скомпилировать. Этот процесс происходит во время установки.
При компиляции эти модули привязываются к версии Node.js. Поэтому после обновления эти части необходимо перекомпилировать.
Начиная с версии js-контроллера 3.0, делается попытка распознать адаптеры, содержащие такие части, и автоматически провести пересборку.
Этот процесс может занять некоторое время, и затронутые адаптеры могут перезапускаться несколько раз.

<details><summary>Автоматические перестроения</summary>

ioBroker пытается автоматически обнаружить адаптеры, которые не запускаются из-за необходимости их обновления. Это работает таким образом, что типичные сообщения об ошибках распознаются, и ioBroker пытается обновить их соответствующим образом. Сначала выполняется «пересборка» затронутого адаптера, если это не помогает, обновляются зависимости адаптера. Поэтому возможно, что адаптер перезапустится несколько раз. Пожалуйста, будьте терпеливы здесь! Становится активным только тогда, когда адаптер остается красным, а в журнале указано, что перестроение не сработало!

</детали>

<details><summary>Ручное восстановление</summary>

Если автоматическая пересборка не сработала, ее можно выполнить вручную, см. Устранение неполадок.

</детали>

<details><summary>Особые случаи (например, последовательный порт)</summary>

К сожалению, есть особые случаи, когда вышеуказанные параметры также не выполняют перестроение, одним из которых является последовательный порт.

Лог может выглядеть так (даже после всех попыток ребилда).

<details><summary>ЖУРНАЛ</summary>

![ЖУРНАЛ](../../de/install/media/Log-Update_NodeJS.jpg)

</детали>

Есть и другие сообщения об ошибках, но все они сводятся к одному и тому же.
Самый простой вариант — вручную перестроить в **правильный** каталог.
В этом случае ищите каталог с «привязками» — выше это */opt/iobroker/node_modules/serialport/node_modules/bindings ...* в более новых версиях это также может быть что-то вроде */opt/iobroker/node_modules/serialport /node_modules /@serialport/bindings*.

Затем переключитесь в этот каталог и выполните `npm install --production`. Затем снова перезапустите адаптер.

Другой случай - адаптеры с модулем холста (возможно, echarts или Mihome-vacuum), где могут быть проблемы.

</детали>

## Руководство по Debian/Ubuntu
#### 1 - Проверить версию и путь
```
which nodejs node npm && nodejs -v && node -v && npm -v
```

- Выход

```
/usr/bin/nodejs
/usr/bin/node
/usr/bin/npm
v14.18.3
v14.18.3
6.14.15
```

#### 2 - Резервное копирование
```
iobroker backup
```

- альтернативные [возможности](https://www.iobroker.net/#de/documentation/config/backup.md)

#### 3 - Обновление адаптера
- Инструкции можно найти в разделе [Управление адаптерами](https://www.iobroker.net/#de/documentation/tutorial/adapter.md)

#### 4 - Остановить ioBroker
```
iobroker stop
```

#### 5 - Проверить процессы ioBroker
```
ps aux | grep 'io\|PID'
```

- а также

```
ps aux | grep 'backup\|PID'

```

- если процессы все еще запущены

```
sudo kill -9 <ProzessID>
```

#### 6 - Обновление Node.JS
- Подробная информация о [Node.Js] (https://github.com/nodesource/distributions#installation-instructions)

```
curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -
sudo apt install -y nodejs
```

- Для других версий Node.js просто замените 16 в URL-адресе другим номером версии.

!> С октября 2022 года для ioBroker рекомендуется версия 16 Node.js!

!> Нельзя использовать нечетные версии Node.js.

#### 7 - Проверить версию/путь
```
which nodejs node npm && nodejs -v && node -v && npm -v
```

#### 8 - Запустить iobroker fixer
```
iobroker fix
```

#### 9 - Запустить ioBroker
```
 iobroker start
 ```

## Инструкции для Windows
#### 1 - Проверить версию (клавиша Windows + R)
```
cmd.exe /C node -v & pause
```

#### 2 - Резервное копирование
```
iobroker backup
```

- альтернативные [возможности](https://www.iobroker.net/#de/documentation/config/backup.md)

#### 3 - Обновление адаптера
- Инструкции можно найти в разделе [Управление адаптерами](https://www.iobroker.net/#de/documentation/tutorial/adapter.md)

#### 4- Резервное копирование папки:
```
C:\Program Files\iobroker\deinhostname\nodejs
```

#### 5 - остановить iobroker
```
iobroker stop
```

#### 6 — Обновление Node.js
- Загрузите [Node.js](https://nodejs.org) в виде архива, а не в виде файла MSI.
- Разархивируйте загрузку и скопируйте всю папку поверх существующей папки:

```
C:\Program Files\iobroker\deinhostname\nodejs
```

- Скопируйте файл **nodevars.bat** из резервной копии обратно в папку:

```
C:\Program Files\iobroker\deinhostname\nodejs
```

#### 7 - Проверить версию
```
cmd.exe /C node -v & pause
```

#### 8 - Запустить iobroker fixer
```
iobroker fix
```

#### 9 - Запустить ioBroker
```
iobroker start
```

## Инструкции для Докера
- Node.js обычно выполняется путем обновления контейнера до новой версии [образа Docker] (https://hub.docker.com/r/buanet/iobroker/tags).
- Подробную процедуру и дополнительные сведения о контейнере iobroker можно найти на [buanet](https://smarthome.buanet.de/2020/10/iobroker-docker-container-updates-upgrades/).

## Исправление проблем
### Ручное восстановление
- Для этого есть

```
iobroker rebuild <adaptername>
```

- если этого недостаточно

```
iobroker rebuild <adaptername> --install
```

- просто запустите его вручную в оболочке. В идеале все должно делаться автоматически.

?> Пока контроллер js ниже версии 4, [ioBroker фиксер](https://www.iobroker.net/#de/documentation/install/linux.md) также должен выполняться с обновлением Node.js в основной версии.
С будущим js-контроллером версии 4 перестроения выполняются полностью автоматически.
После этого ручное восстановление больше не поддерживается.