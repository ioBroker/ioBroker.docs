---
title: Проксмокс
Version: 0.2
Autoren: TeNNo2k5, crunchip
Schlüsselworte: Proxmox, VM, LXC, USB Passthrough, Usb-Backup
lastChanged: 12.08.2023
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/install/proxmox.md
hash: HQHFcoX4FbJQNhhisg7QqnBrRNAt2B/H4N1Yxi9ZKiI=
---
# Проксмокс
![логотип proxmox](../../de/install/media/proxmox/Proxmox-logo-860.png)

## Установка Proxmox
Виртуальная среда Proxmox (сокращенно Proxmox VE) — это платформа виртуализации на базе Debian. Технология виртуализации в Proxmox основана на QEMU/KVM.

Proxmox «упаковывает» QEMU/KVM в собственный веб-интерфейс, что значительно упрощает администрирование (а также поддерживает контейнеры Linux — LXC). Это делает Proxmox, с одной стороны, удобным для новичков, но, с другой стороны, настолько мощным, что его можно использовать и в профессиональной среде.

В этом разделе используется пример, показывающий установку и базовую настройку Proxmox в бесплатной версии (без подписки).

Для наглядности описания изображений и дополнительную информацию можно открыть.

### Требования
<details><summary>Требования</summary>

- 64-битный процессор
- ЦП и материнская плата должны поддерживать Intel VT/AMD-V для виртуализации и должны быть активированы в BIOS.
- 1 ГБ ОЗУ (только для Proxmox) – в зависимости от количества виртуальных машин, здесь, конечно, потребуется больше ОЗУ. Поэтому здесь рекомендуется минимум 8 ГБ, а еще лучше 16 ГБ ОЗУ.

</подробнее>

### Создать ISO-образ/загрузочную флешку
Сначала вам понадобится ISO-образ, который можно скачать с [Страница загрузки Proxmox](https://www.proxmox.com/de/downloads/category/iso-images-pve).

<details><summary>Проксмокс Исо</summary>

![proxmox-iso](../../de/install/media/proxmox/proxmox-iso.png)

</подробнее>

Для установки необходимо создать загрузочную флешку с этим ISO-образом. Здесь должно быть не менее 2 ГБ памяти. Существует несколько способов создания загрузочной флешки, см. [Подготовьте установочный носитель](https://pve.proxmox.com/wiki/Prepare_Installation_Media#_instructions_for_windows).

### Установка
Система должна быть настроена в UEFI/BIOS так, чтобы она могла загружаться с USB-устройства. После вставки USB-накопителя через некоторое время появится меню установки Proxmox (если его нет, вы также можете вручную указать USB-накопитель в качестве стартового носителя (на большинстве материнских плат это можно сделать с помощью F8 или F11).

Просто выберите **Установить Proxmox VE** в меню установки.

<details><summary>Меню установки</summary>

![меню установки](../../de/install/media/proxmox/installationsmenü.png)

</подробнее>

Следующим шагом является согласие с условиями использования (EULA).

<details><summary>Юла</summary>

![еула](../../de/install/media/proxmox/eula.png)

</подробнее>

Следующим шагом будет выбор жесткого диска, на котором будет установлен Proxmox. Если на сервере установлено несколько жестких дисков, обязательно выберите правильный жесткий диск!

<details><summary>Выбор жесткого диска</summary>

![выбор жесткого диска](../../de/install/media/proxmox/festplattenauswahl.png)

</подробнее>

Вы также можете указать дополнительные параметры установочного жесткого диска с помощью кнопки **Параметры**:

<details><summary>Дополнительные параметры жесткого диска</summary>

![варианты жесткого диска](../../de/install/media/proxmox/harddisk-options.png)

</подробнее>

Proxmox использует [Менеджер логических томов](https://de.wikipedia.org/wiki/Logical_Volume_Manager) (LVM). Благодаря расширенным параметрам здесь, помимо прочего, можно детально настроить LVM.
Установщик создает Группу Томов (VG) с именем pve и дополнительные Логические Тома (LV) с именами root (здесь устанавливается сам Proxmox), data (хранилище, на котором хранятся виртуальные диски ВМ) и swap (здесь файл подкачки сохраняется).

<details><summary>В расширенных настройках здесь можно указать определенные параметры:</summary>

- Файловая система: Здесь вы можете выбрать файловую систему. По умолчанию здесь используется ext4, и в большинстве случаев это хороший выбор. Если в хост-системе доступно несколько жестких дисков (и много оперативной памяти), вариант zfs с соответствующим уровнем RAID имеет смысл. В этом случае вам следует принципиально разобраться с ZFS.
- hdsize: определяет общий размер жесткого диска, который следует использовать для Proxmox. Здесь вы обычно выбираете весь размер жесткого диска, если только вы не захотите добавить больше разделов позже.
- swapsize: определяет размер тома подкачки. Стандартным здесь является тот же размер, что и встроенная память, но минимум 4 ГБ и максимум 8 ГБ.
- maxroot: определяет максимальный размер корневого тома (сам Proxmox). **Здесь следует отметить, что при базовой установке здесь также сохраняются необходимые в дальнейшем шаблоны и ISO-образы.**
- minfree: пространство, которое необходимо освободить в группе томов LVM pve. Если размер диска превышает 128 ГБ, по умолчанию остается свободным 16 ГБ (LVM всегда требуется немного свободной памяти для создания моментального снимка).
- maxvz: устанавливает максимальный размер тома данных.

</подробнее>

Обычно вы можете оставить все параметры по умолчанию (т. е. здесь ничего не указано). Они уже оптимально настроены для большинства установок.

После выбора жесткого диска для Proxmox запрашиваются параметры локализации (страна, время и соответствующая раскладка клавиатуры):

<details><summary>Локализация</summary>

![расположение](../../de/install/media/proxmox/location.png)

</подробнее>

Затем вводится пароль пользователя root. Здесь также запрашивается адрес электронной почты. Это используется для отправки электронного письма на указанный здесь адрес в случае важных системных сообщений. Однако это не обязательно должен быть реальный адрес электронной почты (тогда вы как администратор больше не будете получать уведомления о важных системных событиях по электронной почте).

<details><summary>Пароль и адрес электронной почты</summary>

![пароль](../../de/install/media/proxmox/password.png)

</подробнее>

Следующий шаг установщика касается настроек сети. Вы можете выбрать соответствующий интерфейс. Имя хоста можно выбрать произвольно, но также необходимо указать домен DNS.
Например, для пользователей Fritzbox это будет `hostname.fritz.box`.
В качестве IP-адреса желательно указать статический IP-адрес (без DHCP). Сюда входит сам IP-адрес (в формате CIDR), IP-адрес шлюза (обычно IP-адрес маршрутизатора) и используемый DNS-сервер (в частных средах обычно также IP-адрес маршрутизатора). Proxmox обычно обнаруживает сеть автоматически.

<details><summary>сеть</summary>

![сеть](../../de/install/media/proxmox/network.png)

</подробнее>

В конце отображается сводная информация об установке:

<details><summary>Краткое содержание</summary>

![краткое содержание](../../de/install/media/proxmox/zusammenfassung.png)

</подробнее>

Система устанавливается путем проверки настроек и нажатия кнопки «Установить».

<details><summary>установка</summary>

![установка](../../de/install/media/proxmox/installation.png)

</подробнее>

После небольшого ожидания установка завершится и систему необходимо перезагрузить (для этого сначала извлеките флешку с ISO-образом).

После этого вы увидите терминал. Инструкция по доступу в систему уже отображена здесь:

<details><summary>консоль</summary>

![консоль](../../de/install/media/proxmox/konsole.png)

</подробнее>

Теперь продолжается в браузере (например https://10.1.1.89:8006). Однако сначала отображается предупреждение. Это связано с тем, что во время установки был сгенерирован самозаверяющий сертификат, который, естественно, не известен браузеру. На этом этапе вы можете смело игнорировать это сообщение — соединение определенно зашифровано через HTTPS. Само сообщение зависит от браузера. В этом примере нажмите **Дополнительно**, а затем нажмите **Продолжить до 10.1.1.89(небезопасно)**.

<details><summary>Ошибка защиты данных</summary>

![ошибка защиты данных](../../de/install/media/proxmox/datenschutzfehler.png)

</подробнее>

Затем вы входите в систему с пользователем root и паролем, выбранным во время установки. Здесь вы можете **сначала** изменить язык на немецкий, иначе интерфейс Proxmox будет отображаться на английском языке, и вам не придется вводить имя пользователя и пароль второй раз.

<details><summary>Регистрация</summary>

![регистрация](../../de/install/media/proxmox/anmeldung.png)

</подробнее>

Сразу после входа вас встретит сообщение о том, что у вас нет действующей подписки на этот сервер. Это сообщение сначала подтверждается нажатием кнопки ОК.

<details><summary>Подписка</summary>

![подписка](../../de/install/media/proxmox/subskription.png)

</подробнее>

Теперь исходники пакета Proxmox необходимо адаптировать, чтобы вы могли получать обновления.

<details><summary>Источники пакетов</summary>

![исходники пакетов](../../de/install/media/proxmox/paketquellen.png)

</подробнее>

Для этого в исходные коды пакетов добавляется **Репозиторий без подписки**. Это можно сделать в меню экземпляра Proxmox в разделе `Updates > Repositories`. Репозиторий без подписки можно добавить с помощью кнопки «Добавить»:

<details><summary>Отсутствие подписки</summary>

![нет подписки](../../de/install/media/proxmox/no-subscription.png)

</подробнее>

Теперь **Корпоративный репозиторий** должен быть деактивирован. Для этого просто выберите репозиторий pve-enterprise в представлении репозитория и нажмите кнопку **Деактивировать**.

Конфигурация репозиториев выглядит следующим образом:

<details><summary>Корпоративный репозиторий</summary>

![предприятие](../../de/install/media/proxmox/enterprise.png)

</подробнее>

### Обновления
После изменения исходников пакетов следует провести первоначальное обновление системы. Лучше всего это сделать через веб-интерфейс:

<details><summary>Обновления</summary>

![обновления](../../de/install/media/proxmox/updates.png)

</подробнее>

Просто выберите нужный узел Proxmox (например, «pve»), а затем нажмите **Обновить** в разделе «Обновления». Здесь открывается так называемый просмотрщик задач, который всегда отображается при выполнении каких-либо действий в системе. Теперь средство просмотра задач можно снова закрыть. Кстати, когда отображается просмотрщик задач, вам не нужно ждать завершения задачи («ЗАДАЧА ОК»); этот диалог всегда можно закрыть напрямую — задача сама продолжает выполняться в фоновом режиме.
Если обновления теперь доступны, их можно установить, нажав **Обновить**.

Затем здесь откроется веб-консоль, и вы сможете следить за ходом выполнения.

<details><summary>Веб-консоль</summary>

![веб-консоль](../../de/install/media/proxmox/web-konsole.png)

</подробнее>

Конечно, также возможно обновить сервер Proxmox через командную строку (например, через SSH):

```bash
apt update && apt dist-upgrade
```

Единственное, что здесь важно, это то, что вы используете **apt dist-upgrade** (на «обычных» машинах Debian/Ubuntu вы обычно используете apt-upgrade). Однако «dist-upgrade» важен для Proxmox, поскольку он лучше разрешает зависимости, необходимые для работы Proxmox.

В этом отношении Proxmox теперь готов к своей базовой конфигурации. Если вы хотите разобраться с Proxmox более подробно, стоит взглянуть на [Proxmox Wiki](https://pve.proxmox.com/wiki/Main_Page) или на [официальном форуме](https://forum.proxmox.com/).

---

## Proxmox — создание виртуальной машины Qemu/KVM (VM) + последующая установка ioBroker
В этом примере руководства показано, как создать [ВМ](https://pve.proxmox.com/wiki/Qemu/KVM_Virtual_Machines) (стабильную версию Debian (по состоянию на 30 октября 2024 г. = Debian 12 «Книжный червь»)) и затем установить в нее ioBroker.

Конечно, можно использовать Ubuntu вместо Debian, но обязательно используйте сервер Ubuntu **LTS-версию**.

Для наглядности описания изображений и дополнительную информацию можно открыть.

### 1 — Загрузите ISO-образ
Сначала вам понадобится [ISO-образ](https://www.debian.org/distrib/) (64-разрядный PC Netinst ISO), который необходимо загрузить в корневой каталог (локальный) при базовой установке (если не были созданы дополнительные диски).

Для этого перейдите в раздел локальные > ISO-образы. Там есть два варианта.

- С помощью кнопки **Загрузить** ISO-образ, ранее хранившийся на компьютере, можно загрузить на хост Proxmox.
- **Загрузка с URL** можно загрузить ISO непосредственно на хост через URL. Для этого скопируйте адрес ссылки 64-битного PC Netinst ISO (правая кнопка мыши), вставьте URL-адрес и нажмите **Запросить URL**, чтобы получить его. При последнем нажатии **Загрузить** ISO-образ будет загружен напрямую.

<details><summary>Скачать ИСО</summary>

![VM-iso](../../de/install/media/proxmox/vm-iso.png)

![vm-isourl](../../de/install/media/proxmox/vm-isourl.png)

</подробнее>

### 2 — Создать виртуальную машину
При нажатии на синюю кнопку **Создать ВМ** открывается окно, в котором необходимо выполнить следующие настройки.

- Общие: Назначение имени хоста и пароля, указывается идентификатор (начинается со 100), можно изменить, но не позднее.
- ОС: выбор хранилища (локального) и ISO-образа (debian-11-netinst.iso).
- Система: все остается в настройках по умолчанию, **проверьте агент Qemu**
- Диски: Storage local-lvm, размер диска 10ГБ (10-20ГБ должно быть достаточно, изменить его позже возможно, но далее здесь не описано).
- ЦП: Зависит от мощности компьютера (также можно настроить в любое время, необходимо перезапустить ВМ)
- Память: размер ОЗУ в МиБ (также можно изменить в любой момент, необходимо перезапустить ВМ)
- Сеть: vmbr0, все остальное остается как указано
- Подтвердите: здесь вы снова увидите сводку (отметьте **Начать после создания**), а затем нажмите **Готово**, чтобы создать виртуальную машину.

<details><summary>Серия изображений Создать виртуальную машину</summary>

![vm-general](../../de/install/media/proxmox/vm-allgemein.png)

![VM-OS](../../de/install/media/proxmox/vm-os.png)

![система виртуальной машины](../../de/install/media/proxmox/vm-system.png)

![виртуальные диски](../../de/install/media/proxmox/vm-disks.png)

![виртуальный процессор](../../de/install/media/proxmox/vm-cpu.png)

![хранилище виртуальных машин](../../de/install/media/proxmox/vm-speicher.png)

![виртуальная сеть](../../de/install/media/proxmox/vm-netzwerk.png)

![VM-подтвердить](../../de/install/media/proxmox/vm-bestätigen.png)

</подробнее>

### 3 — Установка Debian
После запуска виртуальной машины перейдите в консоль виртуальной машины и запустите **Установку**.

<details><summary>консоль</summary>

![установка виртуальной машины](../../de/install/media/proxmox/vm-install.png)

</подробнее>

Вам будут предоставлены инструкции по установке, и во время этого процесса вам придется выполнить некоторые настройки. Для работы вам понадобятся клавиши табуляции, пробела и стрелок. Из-за размера в серии изображений можно найти разные кадры.

<span style="color:red">**ОПАСНОСТЬ! - Пароль root не может быть назначен.**</span>

Уведомление:

Не выбирайте **iobroker** в качестве имени пользователя, поскольку оно уже используется внутри системы.
Имя пользователя должно состоять только из строчных букв и цифр 0–9 и начинаться с буквы. Дефис также разрешен, но не в качестве первого символа.

<details><summary>Серия изображений Установка Debian</summary>

![вм-1](../../de/install/media/proxmox/vm-1.png)

![вм-2](../../de/install/media/proxmox/vm-2.png)

![вм-3](../../de/install/media/proxmox/vm-3.png)

![вм-4](../../de/install/media/proxmox/vm-4.png)

![вм-5](../../de/install/media/proxmox/vm-5.png)

![вм-6](../../de/install/media/proxmox/vm-6.png)

![вм-7](../../de/install/media/proxmox/vm-7.png)

![вм-8](../../de/install/media/proxmox/vm-8.png)

![вм-9](../../de/install/media/proxmox/vm-9.png)

![вм-10](../../de/install/media/proxmox/vm-10.png)

![вм-11](../../de/install/media/proxmox/vm-11.png)

![вм-12](../../de/install/media/proxmox/vm-12.png)

![вм-13](../../de/install/media/proxmox/vm-13.png)

![вм-14](../../de/install/media/proxmox/vm-14.png)

![вм-15](../../de/install/media/proxmox/vm-15.png)

![вм-16](../../de/install/media/proxmox/vm-16.png)

![вм-17](../../de/install/media/proxmox/vm-17.png)

![вм-18](../../de/install/media/proxmox/vm-18.png)

![вм-19](../../de/install/media/proxmox/vm-19.png)

![вм-20](../../de/install/media/proxmox/vm-20.png)

![вм-21](../../de/install/media/proxmox/vm-21.png)

![вм-22](../../de/install/media/proxmox/vm-22.png)

![вм-23](../../de/install/media/proxmox/vm-23.png)

![вм-24](../../de/install/media/proxmox/vm-24.png)

![вм-25](../../de/install/media/proxmox/vm-25.png)

![вм-26](../../de/install/media/proxmox/vm-26.png)

</подробнее>

### 4 — Настройка виртуальной машины
Перезагрузите виртуальную машину, затем войдите в систему, используя «имя пользователя» и «пароль», назначенные при установке. Затем следует команда

```bash
ip addr
```

IP-адрес был найден. Это необходимо для удаленного подключения к виртуальной машине по ssh, как на следующем шаге.

<details><summary>IP-адрес</summary>

![VM-ipadr](../../de/install/media/proxmox/vm-ipaddr.png)

</подробнее>

Доступ к виртуальной машине теперь можно получить через ssh (например, PuTTY). Здесь вы также снова входите в систему, используя «имя пользователя» и «пароль».
Затем сетевой адрес можно изменить с **dhcp** на **статический**. (что рекомендуется для работы сервера)

```bash
sudo nano /etc/network/interfaces
```

<details><summary>сеть/интерфейсы</summary>

![ВМ-нано](../../de/install/media/proxmox/vm-nano.png)

![виртуальная машина DHCP](../../de/install/media/proxmox/vm-dhcp.png)

![VM-статический](../../de/install/media/proxmox/vm-statisch.png)

</подробнее>

Изменения в редакторе сохраняются комбинацией клавиш CTRL+o, затем ENTER, CTRL+x выходит из редактора.

Изменения IP-адреса вступят в силу только после перезапуска виртуальной машины. Однако перед этим проверяется, активен ли гостевой агент Qemu.

```bash
sudo systemctl status qemu-guest-agent
```

<details><summary>Гостевой агент</summary>

![vm-qemuguest](../../de/install/media/proxmox/vm-qemuguest.png)

</подробнее>

<span style="color:orange">**ОПАСНОСТЬ! - Для установки Ubuntu необходимо установить и запустить гостевой агент Qemu.**</span>

Команды для этого:

```bash
sudo apt-get install qemu-guest-agent
sudo systemctl start qemu-guest-agent
```

Кроме того, чтобы иметь возможность установить iobroker, необходимо переустановить **curl**.

```bash
sudo apt install curl
```

<details><summary>Переустановите локон</summary>

![вм локон](../../de/install/media/proxmox/vm-curl.png)

</подробнее>

Чтобы передать устройства (USB) через виртуальную машину, выберите VM > Оборудование > Добавить > USB-устройства > Производитель/идентификатор устройства. Здесь перечислены все подключенные устройства.

<details><summary>USB-устройства</summary>

![VM-USB](../../de/install/media/proxmox/vm-usb.png)

</подробнее>

Чтобы ВМ запускалась автоматически даже после перезагрузки компьютера (Proxmox), это необходимо активировать в настройках ВМ.

<details><summary>Вариант загрузки</summary>

![загрузка виртуальной машины](../../de/install/media/proxmox/vm-booten.png)

</подробнее>

Установка и настройка виртуальной машины завершена. Теперь виртуальную машину можно перезапустить и установить ioBroker.

---

## Proxmox — Создание контейнера Linux (LXC) + последующая установка ioBroker
В этом примере руководства показано, как создать [LXC-контейнеры](https://pve.proxmox.com/wiki/Linux_Container) (debian11), а затем установить в него ioBroker.

Для наглядности описания изображений и дополнительную информацию можно открыть.

### 1 — Скачать шаблон контейнера
Во-первых, необходим шаблон, который необходимо загрузить в корневой каталог (локальный) при базовой установке (если не были созданы дополнительные диски).

Для этого перейдите в раздел «Локальные» > «Шаблоны контейнеров». При нажатии на **Шаблоны** открывается список выбора. Здесь вы выбираете debian-11-standard(bullseye) и нажимаете «Загрузить».

<details><summary>Скачать шаблон</summary>

![местный](../../de/install/media/proxmox/local.png)

![шаблоны](../../de/install/media/proxmox/templates.png)

![загрузка шаблона](../../de/install/media/proxmox/template-laden.png)

</подробнее>

### 2 — Создать LXC
При нажатии на синюю кнопку **Создать КТ** открывается окно, в котором теперь необходимо выполнить следующие настройки.

- Общие: присвоение имени хоста и пароля, указывается идентификатор (начинается со 100), но его можно изменить.
- Шаблон: выбор хранилища (локальный) и шаблон (стандарт Debian-11).
- Диски: Назначение размера диска (не будьте слишком щедры, вы можете увеличить его в любой момент)
- Процессор: зависит от мощности компьютера (также можно настроить в любое время)
- Память: распределение RAM/Swap (можно регулировать в любое время, даже во время работы)
- Сеть: статическое назначение IP/CIDR, шлюз; если IPv6 не настроен, устанавливается значение SLAAC.
- DNS: обычно ничего не меняется (используйте значения с хоста)
– Подтвердите: Сводка (отметьте **Начать после создания**), затем нажмите **Готово**, чтобы создать контейнер.

<details><summary>Серия изображений Создать КТ</summary>

![пве](../../de/install/media/proxmox/pve.png)

![lxc-general](../../de/install/media/proxmox/lxc-allgemein.png)

![шаблон lxc](../../de/install/media/proxmox/lxc-template.png)

![lxc диски](../../de/install/media/proxmox/lxc-disks.png)

![lxc процессор](../../de/install/media/proxmox/lxc-cpu.png)

![lxc память](../../de/install/media/proxmox/lxc-speicher.png)

![сеть lxc](../../de/install/media/proxmox/lxc-netzwerk.png)

![lxc DNS](../../de/install/media/proxmox/lxc-dns.png)

![lxc-подтвердить](../../de/install/media/proxmox/lxc-bestätigen.png)

![просмотрщик задач lxc](../../de/install/media/proxmox/lxc-taskviewer.png)

</подробнее>

###3 — Настройка LXC
Теперь, когда контейнер запущен, перейдите в консоль LXC.

<details><summary>консоль</summary>

![lxc консоль](../../de/install/media/proxmox/lxc-konsole.png)

</подробнее>

Здесь вы сначала входите в систему как root с ранее назначенным паролем, который был назначен при создании LXC, и обновляете его.

```bash
apt update && apt upgrade
```

<details><summary>Обновление</summary>

![обновление lxc](../../de/install/media/proxmox/lxc-upgrade.png)

</подробнее>

Сразу указано, что часовой пояс еще нужно установить.

```bash
dpkg-reconfigure tzdata
```

<details><summary>Часовой пояс</summary>

![lxc-tzdata](../../de/install/media/proxmox/lxc-tzdata.png)

![площадь lxc](../../de/install/media/proxmox/lxc-area.png)

![Часовой пояс lxc](../../de/install/media/proxmox/lxc-timezone.png)

</подробнее>

Теперь **sudo** и **curl** будут установлены. Sudo необходим для того, чтобы правильно создать пользователя, который будет использоваться на консоли в дальнейшем, как на следующем шаге. Curl необходим для получения сценария установки ioBroker на последнем этапе.

```bash
apt install sudo curl
```

<details><summary>Переустановить</summary>

![lxc судо](../../de/install/media/proxmox/lxc-sudo.png)

</подробнее>

Теперь вы создаете будущего пользователя. В этом случае замените «имя пользователя». Назначение пароля пользователю. Остальное можно подтвердить нажатием ENTER.

Уведомление:

Не выбирайте **iobroker** в качестве имени пользователя, поскольку оно уже используется внутри системы.

```bash
adduser benutzername
```

Затем пользователя необходимо назначить в группу sudo.

```bash
usermod -aG sudo benutzername
```

Если пользователя необходимо создать позже, это все равно необходимо сделать через

```bash
usermod -aG adm,dialout,sudo,audio,video,plugdev,users,iobroker benutzername
```

добавить в соответствующие группы.

<details><summary>Создать пользователя</summary>

![lxc adduser](../../de/install/media/proxmox/lxc-adduser.png)

</подробнее>

На последнем этапе, перед установкой ioBroker, выйдите из системы один раз.

```bash
exit
```

а затем войдите в систему под новым пользователем. iobroker теперь можно установить.

<details><summary>выйти из системы и войти под пользователем</summary>

![вход пользователя lxc](../../de/install/media/proxmox/lxc-useranmeldung.png)

</подробнее>

Чтобы LXC запускался автоматически даже после перезагрузки компьютера (Proxmox), это необходимо активировать в настройках контейнера.

<details><summary>Вариант загрузки</summary>

![lxc-загрузка](../../de/install/media/proxmox/lxc-booten.png)

</подробнее>

### Необязательно: исправление предупреждений/сообщений об ошибках, касающихся незапускаемых служб.
Например, при вызове iobdiag в выходных данных можно найти приведенные ниже сообщения об ошибках.
Иногда они встречаются только в непривилегированных контейнерах, иногда и в привилегированных.

~~~....
***НЕУДАЧНЫЕ УСЛУГИ***

  АКТИВНАЯ ЕДИНИЦА НАГРУЗКИ ПОДОПИСАНИЕ

* run-rpc_pipefs.mount загружен неудачно сбой файловой системы канала RPC
* sys-kernel-config.mount загружен сбой сбой Файловая система конфигурации ядра
* systemd-networkd-wait-online.service загружен сбой, сбой. Подождите, пока сеть будет настроена.

...
~~~

Если вы хотите очистить контейнер перед установкой iobroker, вы можете получить сообщение «FAILED SERVICES» следующим образом:

```bash
systemctl list-units --failed
```

Вот набор процедур устранения неполадок:

#### Не удалось выполнить службу run-rpc_pipefs.mount
```bash
sudo systemctl mask run-rpc_pipefs.mount
sudo systemctl mask var-lib-nfs-rpc_pipefs.mount
```

#### Не удалось выполнить службу sys-kernel-config.mount
Добавьте следующую строку в файл конфигурации контейнера в каталоге `/etc/pve/lxc`:

~~~ lxc.cap.drop: "sys_rawio Audit_read" ~~~

#### Не удалось выполнить службу systemd-networkd-wait-online.service
Замена услуги `ifupdown` на `ifupdown2`:

```bash
sudo systemctl disable --now systemd-networkd-wait-online.service
sudo systemctl disable --now systemd-networkd.service
sudo systemctl disable --now ifupdown-wait-online
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install ifupdown2
```

---

## Установите ioBroker
Все, что вам нужно для установки ioBroker, — это одна команда.

```bash
curl -sLf https://iobroker.net/install.sh | bash -
```

Этапы установки разделены на 4 этапа, которые полностью автоматические.

- Установка необходимых компонентов (1/4)
- Создание пользователя и каталога ioBroker (2/4)
- Установка ioBroker (3/4)
- Завершение установки (4/4)

<details><summary>Установщик</summary>

![установщик iobroker](../../de/install/media/proxmox/iobroker-installer.png)

![iobroker-installer1](../../de/install/media/proxmox/iobroker-installer1.png)

![iobroker-installer2](../../de/install/media/proxmox/iobroker-installer2.png)

![iobroker-installer3](../../de/install/media/proxmox/iobroker-installer3.png)

</подробнее>

Установка будет завершена успешно, когда в конце появится следующее сообщение.

~~~ ioBroker успешно установлен Откройте http://10.1.1.222:8081 в браузере и приступайте к настройке! ~~~

Это также означает, что доступ к ioBroker теперь можно получить в браузере по адресу. Если все заработало без проблем, вас встретит настройка ioBroker. Теперь осталось еще несколько шагов, которые помощник проведет вас.

<details><summary>Серия изображений ioBroker Assistant</summary>

![настройка iobroker](../../de/install/media/proxmox/iobroker-setup.png)

![настройка iobroker1](../../de/install/media/proxmox/iobroker-setup1.png)

![настройка iobroker2](../../de/install/media/proxmox/iobroker-setup2.png)

![настройка iobroker3](../../de/install/media/proxmox/iobroker-setup3.png)

![настройка iobroker4](../../de/install/media/proxmox/iobroker-setup4.png)

![настройка iobroker5](../../de/install/media/proxmox/iobroker-setup5.png)

![настройка iobroker6](../../de/install/media/proxmox/iobroker-setup6.png)

</подробнее>

После этого у вас появится возможность поиска устройств и услуг. Требуемые адаптеры/экземпляры могут быть созданы автоматически.

<details><summary>Поиск устройства/сервиса серии изображений</summary>

![поиск устройства](../../de/install/media/proxmox/gerätesuche.png)

![случаи](../../de/install/media/proxmox/instanzen.png)

![готов к использованию iobroker](../../de/install/media/proxmox/iobroker-fertig.png)

</подробнее>

Установка ioBroker завершена. Дополнительные адаптеры можно установить в любое время в зависимости от применения и пожеланий.

---

## Proxmox — LXC (контейнеры Linux) -> Пропустить USB-устройства через
В этой части инструкций шаг за шагом объясняется, как передать USB-устройство (сквозное USB-соединение) в Proxmox в LXC (контейнер Linux).

С помощью виртуальной машины можно передать USB-устройство напрямую через веб-интерфейс Proxmox с контейнером Linux, файл конфигурации lxc в настоящее время приходится редактировать вручную;

В инструкциях описывается, как интегрировать Zigbee-накопитель **Texas Instruments Inc. CC2531**, но те же действия можно использовать аналогично для других Zigbee-накопителей (ConBee, CC2652P и т. д.) или для других USB-устройств, за исключением сетевых USB-устройств. (Bluetooth/WiFi) можно использовать.

* Для этой части инструкций использовался Proxmox версии 7.1.

### 1.) Соберите информацию о USB-устройстве
<details>

Установление SSH-соединения с Proxmox:

```bash
ssh root@IP-Adresse
```

<span style="color:red">**Если USB-устройство уже подключено к хосту Proxmox, отключите его на данный момент.**</span>

Следующая команда выводит список всех подключенных в данный момент USB-устройств на хосте Proxmox:

```bash
lsusb
```

![proxmoxlxc00](../../de/install/media/proxmox/proxmoxlxc00.PNG)

Теперь интегрируемое USB-устройство подключено к хосту Proxmox, и команда lsusb выполняется снова.

![proxmoxlxc01](../../de/install/media/proxmox/proxmoxlxc01.PNG)

На снимке экрана вы можете видеть, что указано новое устройство с номером шины USB: **001** и номером устройства: **003**.

Эта информация необходима, среди прочего, для использования следующей команды: выведите **основной номер устройства** с устройства:

```bash
ls -l /dev/bus/usb/001/003
```

Важно использовать в команде вывод номера вашей USB-шины и номера устройства!

***ls -l /dev/bus/usb/Номер-USB-шины/Номер-устройства***

![proxmoxlxc02](../../de/install/media/proxmox/proxmoxlxc02.PNG)

В этом примере USB-устройство имеет основной номер устройства **189**. Запишите значение вашего устройства в текстовом файле с примечанием: #1.

![proxmoxlxc03](../../de/install/media/proxmox/proxmoxlxc03.PNG)

Затем мы выводим уникальный идентификатор USB-устройства и отмечаем выходное значение в текстовом файле с примечанием: #2

```bash
ls /dev/serial/by-id/
```

![proxmoxlxc04](../../de/install/media/proxmox/proxmoxlxc04.PNG)

![proxmoxlxc05](../../de/install/media/proxmox/proxmoxlxc05.PNG)

На последнем этапе выводится основной номер устройства ttyACM и отмечается примечанием: #3:

```bash
ls -l /dev/ttyACM*
```

![proxmoxlxc06](../../de/install/media/proxmox/proxmoxlxc06.PNG)

>*Если вывод отсутствует, проверьте с помощью «ls -l /dev/serial/by-id/», интегрировано ли USB-устройство в систему как ttyUSB, если да, замените все следующие команды, которые относятся к **ttyACM… * * получено через **ttyUSB…**. Если вывод не отображается, это не устройство класса USB CDC (последовательная связь), поэтому все пункты по интеграции ttyACM можно игнорировать.*

Итак, мы отметили **три** значения с USB-устройства, необходимые для интеграции в файл конфигурации lxc.

![proxmoxlxc07](../../de/install/media/proxmox/proxmoxlxc07.PNG)

</подробнее>

### 2.) Отредактируйте файл конфигурации LXC.
<details>

Перейдите в каталог конфигурации LXC на хосте Proxmox с помощью:

```bash
cd /etc/pve/lxc
```

Файл конфигурации имеет тот же идентификационный номер, который был присвоен при создании lxc!

![proxmoxlxc08](../../de/install/media/proxmox/proxmoxlxc08.PNG)

![proxmoxlxc09](../../de/install/media/proxmox/proxmoxlxc09.PNG)

Перед редактированием файла конфигурации необходимо создать резервную копию:

```bash
cp 201.conf 201.conf.backup
```

![proxmoxlxc10](../../de/install/media/proxmox/proxmoxlxc10.PNG)

Теперь файл конфигурации редактируется с помощью vi или nano:

```bash
nano 201.conf
```

![proxmoxlxc11](../../de/install/media/proxmox/proxmoxlxc11.PNG)

В конец файла конфигурации добавляется следующее:

~~~ lxc.cgroup2.devices.allow: c 189:* rwm lxc.mount.entry: usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00 dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC__ _ 0X00124B0012023529-if00 нет привязки, необязательно, создать = файл

lxc.cgroup2.devices.allow: c 166:* rwm lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательно, create=file ~~~

Замените отмеченные значения отмеченными записями из вашей заметки!

![12](../../de/install/media/proxmox/proxmoxlxc12.PNG)

* Первая строка относится к основному номеру устройства **189** Примечание: #1
*Во второй строке уникальный идентификатор (usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00) из примечания:#2 указывается индивидуально и с абсолютным путем, обратите внимание, что весь текст пишется в одну строку без переноса строки.
* В третьей строке указан основной номер устройства **166** ttyACM из примечания: #3.

Сохраните файл конфигурации (в Nano Editor с помощью комбинации клавиш: CTRL + o & CTRL + x для выхода из редактора)

</br>

<span style="color:orange">**ОПАСНОСТЬ! – Если в вашем контейнере есть активные снимки:**</span>

<details>

Тогда код lxc.cgroup находится не в конце файла конфигурации, а перед первой записью снимка.

![proxmoxlxc18](../../de/install/media/proxmox/proxmoxlxc18.PNG)

</подробнее>

<span style="color:orange">**ОПАСНОСТЬ! - Установка Proxmox до версии 7.0:**</span>

<details>

Замените записи на

~~~ lxc.cgroup2 ~~~

через

~~~ lxc.cgroup ~~~

</подробнее>

</br> Наконец, введите следующую команду, чтобы установить необходимые права для ttyACM0:

```bash
chmod o+rw /dev/ttyACM*
```

Чтобы применить изменения к lxc, выполните холодную загрузку из контейнера с **pct stop id/pct start id**:

```bash
pct stop 201
```

```bash
pct start 201
```

</br>

<span style="color:green">**Совет: лучше всего хранить копию рабочего файла конфигурации снаружи, например. Б. встроенная служба резервного копирования Proxmox не создает резервную копию содержимого вашей конфигурации!**</span>

</br>

</подробнее>

### 3.) Проверьте сквозную передачу USB LXC и конфигурацию экземпляра Zigbee.
<details>

Установление SSH-соединения с LXC:

```bash
ssh Benutzer@IP-Adresse
```

С помощью команд:

```bash
lsusb
```

&

```bash
ls -l /dev
```

Он проверяет, были ли изменения в файле конфигурации успешными.

![proxmoxlxc13](../../de/install/media/proxmox/proxmoxlxc13.PNG)

* Как видно на скриншоте, контейнер теперь имеет доступ к USB-устройству.

* Важно, чтобы ttyACM0 имел те же права, что и на скриншоте, т.е. **crw-rw-rw- 1 none nogroup**

>***Если вы не проверили, все ли значения в файле конфигурации выставлены так, как описано, права все равно не должны совпадать, переходите к пункту 5.***

* На скриншоте вы также можете видеть, что номер устройства cc2531 изменился со значения 3 на 4, это связано с тем, что флешка в это время была отключена и снова подключена. Однако, поскольку в файле конфигурации указан уникальный идентификатор, а не номер шины/устройства, сквозное соединение USB продолжает работать.

Если в контейнер пропущен Zigbee-флешка, как описано вначале, то она должна быть в iobroker в настройках Zigbee-адаптера под пунктом Имя COM-порта

~~~ /dev/ttyACM0 ~~~

необходимо указать, чтобы адаптер обращался к правильному устройству.

![proxmoxlxc14](../../de/install/media/proxmox/proxmoxlxc14.PNG)

</подробнее>

### 4.) Правило UDEV для постоянной настройки прав ttyACM0
<details>

В конце шага 3 была команда

```bash
chmod o+rw /dev/ttyACM*
```

Соответствующие права для ttyACM0 установлены, но эти изменения прав сбрасываются при перезапуске хоста Proxmox. Для постоянной настройки на хосте Proxmox требуется правило udev.

С помощью lsusb мы снова перечисляем подключенные в данный момент USB-устройства:

```bash
lsusb
```

![proxmoxlxc15](../../de/install/media/proxmox/proxmoxlxc15.PNG)

На этот раз записываем числовые значения по ID в данном случае **0451:16a8**

* Первое значение: ***0451*** соответствует **idVendor**, а второе значение: ***16a8*** — **idProduct**.

Теперь используйте vi или nano, чтобы создать правило udev в /etc/udev/rules.d:

```bash
nano /etc/udev/rules.d/50-myusb.rules
```

и добавлен следующий контент:

~~~ SUBSYSTEMS=="usb", ATTRS{idVendor}=="0451", ATTRS{idProduct}=="16a8", GROUP="users", MODE="0666" ~~~

![proxmoxlxc16](../../de/install/media/proxmox/proxmoxlxc16.PNG)

Наконец, выполните следующую команду, чтобы активировать правило udev:

```bash
udevadm control –-reload
```

</подробнее>

### 5.) Устранение неполадок
<details>

**Ошибка:** права ttyACM0 в lxc не подходят или теряются через некоторое время (ConBee II).

```bash
ls -l /dev/ttyACM0
 c--------- 0 nobody nogroup 166, 0 Feb  7 14:29 ttyACM0
```

</br>

**Решение.** Создайте постоянную привязку для контейнера с помощью mknod.

Для этого создается папка **devices** по пути **"/var/lib/lxc/CONTAINERID"** и в этой папке создается привязка с помощью mknod:

```bash
mkdir /var/lib/lxc/201/devices
```

```bash
cd /var/lib/lxc/201/devices
```

```bash
mknod -m 666 ttyACM0 c 166 0
```

+ *mknod создает в пути файл с именем ttyACM0 (пока файл существует, устройство привязано к lxc)*

![proxmoxlxc17](../../de/install/media/proxmox/proxmoxlxc17.PNG)

***основной номер устройства и ttyACM. При необходимости откорректируйте***

Затем необходимо изменить запись в файле конфигурации lxc:

~~~ lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательно, create=file ~~~

заменяется:

~~~ lxc.mount.entry: /var/lib/lxc/CONTAINERID/devices/ttyACM0 dev/ttyACM0 нет привязки, необязательно, create=file ~~~

</подробнее>

---

## Настройте USB-накопитель/диск для резервного копирования.
Чтобы будущие резервные копии можно было сохранять отдельно, можно интегрировать USB-устройство в виде флешки или диска в хост Proxmox.
Для этого устройство должно иметь определенный формат.
Обычными [Файловые системы](https://wiki.ubuntuusers.de/Dateisystem/) являются **vFAT** или **NTFS**. Оба могут быть прочитаны как в Linux, так и в Windows или MacOS.
Для чистого Linux обычно **EXT4**.

Если носитель данных все еще не разбит на разделы или вы хотите его переформатировать, вы можете сделать это на ПК с Windows (ntfs) или непосредственно на сервере Proxmox.
После того, как носитель данных подготовлен, его можно смонтировать в системе, а затем добавить в качестве хранилища (каталога) непосредственно через графический интерфейс Proxmox.

<span style="color:orange">**ОПАСНОСТЬ! - При переформатировании все предыдущие данные на носителе данных удаляются</span>

Следующие примеры инструкций относятся к настройке непосредственно на хосте Proxmox. Вы также можете использовать ssh/putty.

**Обратите внимание: для следующих команд требуется root. Если на хосте используется отдельный пользователь, приведенные ниже команды должны выполняться с sudo впереди.**

### Подготовьте устройство
### 1 — Определить устройство
Сначала вы находите устройство, используя [лсблк](https://wiki.ubuntuusers.de/lsblk/). Желательно выполнить команду один раз до и после подключения. Это облегчает идентификацию устройства.

```bash
lsblk
```

Тогда это выглядит примерно так (буквы различаются в зависимости от того, сколько устройств интегрировано)

~~~ sdd 8:48 0 119.2G 0 disk ├─sdd1 8:49 0 119.2G 0 часть └─sdd9 8:57 0 8M 0 часть sde 8:64 0 931.5G 0 disk <-- Это диск / dev/sde └─sde1 8:65 0 931.5G 0 часть <-- Это первый раздел /dev/sde1, если он уже отформатирован sr0 11:0 1 1024M 0 rom sr1 11:1 1 1024M 0 rom ~~~

### 2 — Разделение
Диск разбит на разделы, управляемые через меню [cfdisk](https://wiki.ubuntuusers.de/fdisk/).

```bash
cfdisk /dev/sde
```

###3 — Создать файловую систему
Теперь созданный ранее раздел еще нужно отформатировать. Как уже говорилось выше, существуют разные варианты в зависимости от предполагаемого использования.
Раздел форматируется командой [мкфс](https://wiki.ubuntuusers.de/Formatieren/) и соответствующими параметрами.

```bash
mkfs.vfat /dev/sde1
```

### 4 — Подключить диск
Чтобы иметь возможность использовать готовый носитель данных, он должен быть [установлен](https://wiki.ubuntuusers.de/mount/).

Для этого создается подходящая точка монтирования и чтобы носитель данных автоматически перемонтировался после перезагрузки, также нужна соответствующая запись в файле [/etc/fstab](https://wiki.ubuntuusers.de/fstab/).

Для этого необходимо прочитать уникальный **UUID** накопителя.

Создать точку монтирования

```bash
mkdir /media/ext_usb
```

Монтировать диск

```bash
mount /dev/sde1 /media/ext_usb
```

Определить UUID

```bash
blkid | grep -i sde
```

результаты ~~~ /Dev /SDE1: Label = "Export_bilder" Uuid = "136b058d-F0C8-A82B-2ADC00B72BF" UUID_SUB = "951E8519-84-B093-C3597F989" Block_Size = " BTRFS " PARTUUID="00011a10-01" ~~ ~

Отредактируйте запись в */etc/fstab* с помощью nano

```bash
nano /etc/fstab
```

теперь эта запись добавляется и затем сохраняется ~~~ UUID="136b058d-f0c8-406d-a82b-2adcc00b72bf" /media/ext_usb vfat defaults 0 0 ~~~

### 5- Добавьте хранилище в Proxmox
Теперь каталог можно добавить в разделе «Центр обработки данных» > «Хранилище». Идентификатор можно выбрать произвольно, например *usb-backup*.

Путь указывается в столбце *Directory*, в данном случае */media/ext_usb*.

В разделе *Содержание* вам просто нужно выбрать желаемый запрос.