---
translatedFrom: en
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/adapterref/iobroker.tibberlink/README.md
title: ioBroker.tibberlink
hash: NzdSoFAr8e/3DyZF2cTRxaRpX5UqZMhEYaW5foZ+lNE=
---
![Логотип](../../../en/adapterref/iobroker.tibberlink/admin/tibberlink.png)

![версия НПМ](https://img.shields.io/npm/v/iobroker.tibberlink?style=flat-square)
![Загрузки](https://img.shields.io/npm/dm/iobroker.tibberlink?label=npm%20downloads&style=flat-square)
![node-lts](https://img.shields.io/node/v-lts/iobroker.tibberlink?style=flat-square)
![Статус зависимости Libraries.io для последней версии](https://img.shields.io/librariesio/release/npm/iobroker.tibberlink?label=npm%20dependencies&style=flat-square)
![GitHub](https://img.shields.io/github/license/hombach/iobroker.tibberlink?style=flat-square)
![Размер репозитория GitHub](https://img.shields.io/github/repo-size/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Активность коммитов GitHub](https://img.shields.io/github/commit-activity/m/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Последний коммит GitHub](https://img.shields.io/github/last-commit/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Проблемы с GitHub](https://img.shields.io/github/issues/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Статус рабочего процесса GitHub](https://img.shields.io/github/actions/workflow/status/hombach/iobroker.tibberlink/test-and-release.yml?branch=master&logo=github&style=flat-square)
![Appveyor-CI](https://ci.appveyor.com/api/projects/status/github/hombach/ioBroker.tibberlink?branch=master&svg=true)
![Известные уязвимости SNYK](https://snyk.io/test/github/hombach/ioBroker.tibberlink/badge.svg)
![Бета](https://img.shields.io/npm/v/iobroker.tibberlink.svg?color=red&label=beta)
![Стабильный](https://iobroker.live/badges/tibberlink-stable.svg)
![Установлено](https://iobroker.live/badges/tibberlink-installed.svg)
![НПМ](https://nodei.co/npm/iobroker.tibberlink.png?downloads=true)

# IoBroker.tibberlink
[![CodeQL](https://github.com/hombach/ioBroker.tibberlink/actions/workflows/codeql-analysis.yml/badge.svg)](https://github.com/hombach/ioBroker.tibberlink/actions/workflows/codeql-analysis.yml)

## Версии
## Адаптер для использования данных энергии TIBBER в ioBroker
Этот адаптер упрощает подключение данных из API вашей учётной записи Tibber для использования в ioBroker, как для одного дома, так и для нескольких.
Новая функция: адаптер теперь поддерживает прямое локальное считывание данных датчика импульсов Tibber через домашнюю сеть, что позволяет осуществлять мониторинг и сбор данных в режиме реального времени, не полагаясь исключительно на облачный API.

Если вы еще не являетесь пользователем Tibber, я был бы очень признателен, если бы вы могли воспользоваться моей реферальной ссылкой: [Реферальная ссылка Тиббера](https://invite.tibber.com/mu8c82n5).

## Стандартная конфигурация
- Начните с создания нового экземпляра адаптера.
- Вам также потребуется токен API от Tibber, который можно получить здесь: [Tibber Developer API](https://developer.tibber.com).
- Введите свой токен API Tibber в стандартных настройках и настройте хотя бы одну строку для параметров прямой трансляции (выберите «Нет доступных»).
- Сохраните настройки и выйдите из режима конфигурации, чтобы перезапустить адаптер; этот шаг позволит вашему дому(ам) впервые получить запрос от сервера Tibber.
- Вернитесь на экран настройки и выберите дома, данные с которых вы хотите получать в режиме реального времени с помощью Tibber Pulse. Вы также можете выбрать дома и отключить передачу данных (Примечание: это работает только при наличии установленного оборудования и подтверждении сервером Tibber подключения к Pulse).
Примечание: если в вашей учётной записи Tibber активны несколько домов, вам необходимо добавить их все, чтобы избавиться от сообщения об ошибке, вызванной потенциально ненужными домами. Добавьте их все и отключите соответствующие опции.
- У вас есть возможность отключить получение данных о ценах на сегодня и завтра, например, если вы собираетесь использовать только прямые трансляции Pulse.
– При желании вы можете включить получение исторических данных о потреблении. Укажите количество наборов данных для часов, дней, недель, месяцев и лет. Значение «0» можно использовать для отключения одного или нескольких интервалов в зависимости от ваших предпочтений.
Примечание: важно учитывать размер набора данных, так как слишком большие запросы могут привести к отсутствию ответа от сервера Tibber. Мы рекомендуем поэкспериментировать с размером набора данных для обеспечения оптимальной функциональности. Изменение интервалов и количества наборов данных поможет найти оптимальный баланс между получением содержательных данных и поддержанием скорости отклика сервера. Например, 48 запросов — это вполне приемлемое значение для часов.
- Сохраните настройки.

## Конфигурация калькулятора
- Теперь, когда соединение Tibber установлено и работает, вы также можете использовать Калькулятор для включения дополнительных функций автоматизации в адаптер TibberLink.
- Калькулятор работает с использованием каналов, каждый канал привязан к выбранному дому.
- Эти состояния предназначены для использования в качестве внешних динамических входов для TibberLink, позволяя, например, корректировать предельную стоимость («TriggerPrice») из внешнего источника или включать канал калькулятора («Active»).
- Эти каналы должны быть активированы или деактивированы в зависимости от соответствующих состояний.
– Состояния канала калькулятора располагаются рядом с домашними состояниями и названы в соответствии с номером канала. Таким образом, имя канала, выбранное на экране администратора, отображается здесь для более удобной идентификации ваших конфигураций.

  ![Состояния калькулятора](../../../en/adapterref/iobroker.tibberlink/docu/calculatorStates.png)

- Поведение каждого канала определяется его типом: «лучшая стоимость (LTF)», «лучшие отдельные часы (LTF)», «лучший блок часов (LTF)» или «умный буфер батареи».
- Каждый канал выводит одно или два внешних состояния, которые необходимо выбрать на вкладке настроек. Например, это может быть «0_userdata.0.example_state» или любое другое записываемое внешнее состояние.
- Если внешнее выходное состояние не выбрано, будет создано внутреннее состояние в диапазоне канала.
- Значения, которые необходимо записать в выходное состояние, можно определить как «значение ДА» и «значение НЕТ», например, «истина» для логических состояний или число или текст, которые необходимо записать.
- Выходы:
- «Лучшая стоимость»: использует состояние «TriggerPrice» в качестве входных данных, выдавая на выходе «ДА» каждый час, когда текущая стоимость энергии Tibber ниже цены триггера.
- «Лучшие отдельные часы»: Формирует вывод «ДА» в течение наименее дорогих часов с числом, указанным в состоянии «AmountHours».
- «Блок лучших часов»: выводит «ДА» в течение наиболее экономически эффективного блока часов с количеством часов, указанным в состоянии «AmountHours».

Кроме того, средняя общая стоимость в выбранном блоке записывается в состояние "AverageTotalCost" рядом с входными состояниями этого канала. Также в результате расчёта в состояния "BlockStartFullHour" и "BlockEndFullHour" записывается время начала и окончания блока.

- «Лучший процент»: выводит «ДА» в течение наименее дорогого часа и любых других часов, когда цена попадает в процентный диапазон, указанный в настройках «Процент».
- «Лучшая стоимость LTF»: «Лучшая стоимость» в течение ограниченного периода времени (LTF).
- «Лучшие отдельные часы LTF»: «Лучшие отдельные часы» в течение ограниченного периода времени (LTF).
- «Блок лучших часов LTF»: «Блок лучших часов» в течение ограниченного периода времени (LTF).
- «Лучший процент LTF»: «Лучший процент» в течение ограниченного периода времени (LTF).
– «Smart Battery Buffer»: используйте параметр «EfficiencyLoss» для определения потери эффективности аккумуляторной системы. Параметр «EfficiencyLoss» может принимать значения от 0 до 1, где 0 соответствует отсутствию потери эффективности, а 1 – полной потере эффективности. Например, значение 0,25 соответствует потере эффективности 25% за цикл заряда/разряда.

Используйте параметр "AmountHours" для ввода желаемого количества часов зарядки аккумулятора (округлённого до четверти часа). Калькулятор активирует зарядку аккумулятора ("значение "ДА") и деактивирует питание от аккумулятора ("значение "2" НЕТ") в течение указанного "AmountHours" самого дешёвого временного интервала. И наоборот, он деактивирует зарядку аккумулятора ("значение "НЕТ") и активирует питание от аккумулятора ("значение "2" ДА") в течение временных интервалов с самой высокой стоимостью, при условии, что эта стоимость превышает максимальную общую стоимость среди дешёвых временных интервалов. В оставшиеся временные интервалы с обычной стоимостью, где буферизация энергии аккумулятором экономически нецелесообразна, оба выхода будут отключены.

– Каналы LTF: работают аналогично стандартным каналам, но активны только в течение периода времени, определяемого объектами состояния StartTime и StopTime. По истечении StopTime канал автоматически деактивируется. StartTime и StopTime могут охватывать два календарных дня, поскольку Tibber не предоставляет данные за пределами 48-часового окна. Для обоих состояний требуется строка даты и времени в формате ISO-8601 со смещением часового пояса, например, «2024-12-24T18:00:00.000+01:00». Кроме того, каналы LTF имеют новый параметр состояния «RepeatDays», который по умолчанию равен 0. Если для «RepeatDays» задано положительное целое число, канал будет повторять свой цикл, увеличивая «StartTime» и «StopTime» на указанное количество дней после достижения «StopTime». Например, установите для «RepeatDays» значение 1 для ежедневного повторения.

## Конфигурация выходного графика
Адаптер помогает визуализировать ценовые тенденции и результаты калькулятора. Он предлагает три уровня сложности, каждый из которых предлагает различные возможности.
Эти три метода предоставляют различные варианты визуализации ценовых тенденций и результатов калькулятора. В зависимости от ваших требований вы можете выбрать от простого подхода на основе JSON до полностью настраиваемого решения на JavaScript.

### 1. **(В разработке) Визуализация с использованием адаптера «E-Charts»**
Для этого метода требуется отдельная установка адаптера «E-Charts».

- Можно использовать данные JSON, сгенерированные в разделе «Состояния калькулятора» как «Output-E-Charts».
- Возможности ограничены ограничениями адаптера E-Charts.

### 2. **Использование адаптера «FlexCharts» (или «Fully Featured eCharts») с JSON**
Для этого метода требуется отдельная установка адаптера «FlexCharts».

- Адаптер TibberLink создает состояние под названием `jsonFlexCharts`.

    ![jsonFlexChartsState.png](../../../en/adapterref/iobroker.tibberlink/docu/jsonFlexChartsState.png)

- Адаптер FlexCharts отображает это состояние через следующий URL-адрес:

```
http://[YOUR IP of FLEXCHARTS]:8082/flexcharts/echarts.html?source=state&id=tibberlink.0.Homes.[TIBBER-HOME-ID].PricesTotal.jsonFlexCharts
```

- Более подробную информацию см. в [документации по адаптеру FlexCharts](https://github.com/MyHomeMyData/ioBroker.flexcharts).

#### **Использование шаблона JSON**
- Состояние `jsonFlexCharts` формируется на основе шаблона, настроенного через редактор JSON в настройках адаптера.
- **Важно:** Встроенный редактор JSON в ioBroker.Admin не поддерживает JSON5, что может приводить к появлению ложных сообщений об ошибках.
- Пример шаблона можно загрузить по ссылке: [TemplateFlexChart01.md](docu/TemplateFlexChart01.md).
- Скопируйте и вставьте шаблон в редактор JSON.
- Шаблон содержит заполнители:
- `%%xAxisData%%` и `%%yAxisData%%` (заполняются информацией о ценах во время выполнения).
- `%%CalcChannelsData%%` (заполняется данными выбранного канала калькулятора).
- Остальная часть шаблона соответствует конфигурации Apache ECharts. См. [Примеры Apache ECharts](https://echarts.apache.org/examples/en/index.html).
- **Рекомендация:** Протестируйте адаптер TibberLink без реального шаблона, используя строку по умолчанию:

```
%%xAxisData%%\n\n%%yAxisData%%\n\n%%CalcChannelsData%%
```

Это помогает понять его функциональность.

- Изменения шаблона можно протестировать на страницах примеров Apache ECharts, используя данные состояния «Output-E-Charts».
- Хорошие шаблоны будут распространены в сообществе адаптеров TibberLink.

### 3. **Использование FlexCharts с пользовательским кодом JavaScript**
Для максимальной гибкости и настройки адаптер FlexCharts можно использовать с пользовательским JavaScript.

- Адаптеры «FlexCharts» и «JavaScript» необходимо устанавливать отдельно.
- Такой подход позволяет создавать несколько настраиваемых графиков.
- Более подробную информацию см. в [обсуждении адаптера FlexCharts](https://github.com/MyHomeMyData/ioBroker.flexcharts/discussions/67).

## Подсказки
### Обратное использование
Например, чтобы получить часы пик вместо оптимальных часов, просто поменяйте местами использование и параметры: ![Калькулятор Состояния Обратные](../../../en/adapterref/iobroker.tibberlink/docu/calculatorStatesInverse.png) Поменяв местами true <-> false, вы получите true по низкой стоимости в первой строке и true по высокой стоимости во второй строке (названия каналов не являются триггерами и по-прежнему могут быть выбраны).

Внимание: для отдельных часов пик, как в примере, также необходимо скорректировать количество часов. Исходное значение: 5 -> Обратное (24-5) = 19 -> Вы получите истинный результат для 5 часов пик.

### LTF-каналы
Расчёт выполняется для многодневных данных. Поскольку у нас есть информация только за «сегодня» и «завтра» (доступная примерно после 13:00), временной интервал фактически ограничен максимум 35 часами. Однако крайне важно учитывать это, поскольку расчётный результат может измениться/изменится около 13:00, когда появятся новые данные о ценах на завтра.

Чтобы отслеживать динамику изменения временного диапазона для стандартного канала, можно выбрать ограниченный временной интервал (LTF), охватывающий несколько лет. Это особенно полезно для сценария «Лучший одиночный час LTF».

## Прямой локальный опрос данных Pulse
Чтобы это заработало, необходимо изменить веб-интерфейс Bridge так, чтобы он оставался постоянно включённым.
marq24 отлично описал, как это сделать для интеграции с HomeAssistant, здесь:

https://github.com/marq24/ha-tibber-pulse-local

Если все работает правильно, данные счетчиков будут записываться в состояния ioBroker каждые 2 секунды.

## Часовой
Этот адаптер использует библиотеки Sentry для автоматического сообщения разработчикам об исключениях и ошибках кода. Подробнее об отключении сообщений об ошибках см. в разделе [Документация по плагину Sentry](https://github.com/ioBroker/plugin-sentry#plugin-sentry)! Отправка сообщений Sentry доступна начиная с версии js-controller 3.0.

## Пожертвовать
<a href="https://www.paypal.com/donate/?hosted_button_id=F7NM9R2E2DUYS"><img src="https://raw.githubusercontent.com/Hombach/ioBroker.tibberlink/master/docu/bluePayPal.svg" height="40"></a> Если вам понравился этот проект — или вы просто проявили щедрость, — угостите меня пивом. За здоровье! :beers:

## Changelog

<!--
  Placeholder for the next version (at the beginning of the line):
  ### **WORK IN PROGRESS**
-->

### **WORK IN PROGRESS**

- (HombachC) clean code for 15min time slots

### 6.0.3 (2025-11-16)

- (HombachC) optimize sentry
- (HombachC) optimize dependabot config (#805)
- (HombachC) update axios and cron
- (HombachC) update FlexChart template

### 6.0.2 (2025-10-24)

- (HombachC) update NPM deployment
- (HombachC) update dependencies

### 6.0.1 (2025-10-09)

- (HombachC) fix error in cleaning tomorrow data
- (HombachC) update release management to 4.x.x

### 6.0.0 (2025-10-06)

- (HombachC) BREAKING: hourly price states (0...23) are now quarterhourly (0...95)
- (HombachC) BREAKING: adapted calculator time blocks need reentry of "AmountHours" values
- (HombachC) change price updates to 15 minutes resolution as default
- (HombachC) change current price updates to use existing today values instead of Tibber calls
- (HombachC) more timely precision for current price and calculator
- (HombachC) adapt chart generation
- (HombachC) fix error in efficiency loss
- (HombachC) adapt calculator time blocks
- (HombachC) update tibber-api to 5.5.2
- (HombachC) update typescript to 5.9.3 (#777)
- (HombachC) add names to price states folders

### 5.0.4 (2025-09-27)

- (HombachC) prepared price updates to 15 minutes resolution (#384)
- (HombachC) update tibber-api to 5.4.2
- (HombachC) update chai system

### Old Changes see [CHANGELOG OLD](CHANGELOG_OLD.md)

## License

GNU General Public License v3.0 only

Copyright (c) 2023-2025 C.Hombach <TibberLink@homba.ch>