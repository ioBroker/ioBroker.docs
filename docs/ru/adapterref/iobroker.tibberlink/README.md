---
translatedFrom: en
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/adapterref/iobroker.tibberlink/README.md
title: ioBroker.tibberlink
hash: v6FxPWFAENHd0IH3Y9/brIEtva1r3Zc6X3khIMaTbtI=
---
![Логотип](../../../en/adapterref/iobroker.tibberlink/admin/tibberlink.png)

![Версия NPM](https://img.shields.io/npm/v/iobroker.tibberlink?style=flat-square)
![Загрузки](https://img.shields.io/npm/dm/iobroker.tibberlink?label=npm%20downloads&style=flat-square)
![node-lts](https://img.shields.io/node/v-lts/iobroker.tibberlink?style=flat-square)
![Статус зависимостей Libraries.io для последней версии](https://img.shields.io/librariesio/release/npm/iobroker.tibberlink?label=npm%20dependencies&style=flat-square)
![GitHub](https://img.shields.io/github/license/hombach/iobroker.tibberlink?style=flat-square)
![размер репозитория GitHub](https://img.shields.io/github/repo-size/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![активность коммитов на GitHub](https://img.shields.io/github/commit-activity/m/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Последний коммит на GitHub](https://img.shields.io/github/last-commit/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Проблемы на GitHub](https://img.shields.io/github/issues/hombach/iobroker.tibberlink?logo=github&style=flat-square)
![Статус рабочего процесса GitHub](https://img.shields.io/github/actions/workflow/status/hombach/iobroker.tibberlink/test-and-release.yml?branch=master&logo=github&style=flat-square)
![Appveyor-CI](https://ci.appveyor.com/api/projects/status/github/hombach/ioBroker.tibberlink?branch=master&svg=true)
![Известные уязвимости SNYK](https://snyk.io/test/github/hombach/ioBroker.tibberlink/badge.svg)
![Бета](https://img.shields.io/npm/v/iobroker.tibberlink.svg?color=red&label=beta)
![Стабильный](https://iobroker.live/badges/tibberlink-stable.svg)
![Установлено](https://iobroker.live/badges/tibberlink-installed.svg)
![НПМ](https://nodei.co/npm/iobroker.tibberlink.png?downloads=true)

# IoBroker.tibberlink
[![CodeQL](https://github.com/hombach/ioBroker.tibberlink/actions/workflows/codeql-analysis.yml/badge.svg)](https://github.com/hombach/ioBroker.tibberlink/actions/workflows/codeql-analysis.yml)

## Версии
## Адаптер для использования данных об энергопотреблении TIBBER в ioBroker
Этот адаптер упрощает подключение данных из API вашей учетной записи Tibber для использования в ioBroker, независимо от того, используется ли он для одного или нескольких домов.
Новая функция: адаптер теперь поддерживает прямое локальное считывание данных с датчика Tibber Pulse Sensor через вашу домашнюю сеть, что позволяет осуществлять мониторинг и сбор данных в режиме реального времени, не полагаясь исключительно на облачный API.

Если вы еще не пользуетесь Tibber, я буду очень признателен, если вы воспользуетесь моей реферальной ссылкой: [Реферальная ссылка Tibber](https://invite.tibber.com/mu8c82n5).

## Стандартная конфигурация
Для начала создайте новый экземпляр адаптера.
— Вам также потребуется API-токен от Tibber, который можно получить здесь: [Tibber Developer API](https://developer.tibber.com).
— Введите свой API-токен Tibber в стандартных настройках и укажите как минимум одну строку для параметров прямой трансляции (выберите «Нет в наличии»).
— Сохраните настройки и выйдите из режима конфигурации, чтобы перезапустить адаптер; этот шаг позволит выполнить первый запрос к вашему(им) дому(ам) с сервера Tibber.
— Вернитесь на экран настроек и выберите дома, из которых вы хотите получать данные в реальном времени с помощью Tibber Pulse. Вы также можете выбрать дома и отключить передачу данных (Примечание: это работает только в том случае, если оборудование установлено и сервер Tibber подтвердил подключение к Pulse).
Примечание: Если в вашей учетной записи Tibber активно используется более одного дома, вам необходимо добавить их все, чтобы избавиться от сообщения об ошибке, вызванного потенциально ненужными домами. Добавьте их все и отключите соответствующие параметры.
— У вас есть возможность отключить получение данных о ценах на сегодня и завтра, например, если вы планируете использовать только прямые трансляции Pulse.
— При желании вы можете включить получение исторических данных о потреблении. Укажите количество наборов данных для часов, дней, недель, месяцев и лет. Вы можете использовать «0», чтобы отключить один или несколько из этих интервалов в соответствии с вашими предпочтениями.
Примечание: Важно учитывать размер набора данных, поскольку чрезмерно большие запросы могут привести к отсутствию ответа от сервера Tibber. Мы рекомендуем поэкспериментировать с размером набора данных, чтобы обеспечить оптимальную функциональность. Настройка интервалов и количества данных в наборе данных поможет найти правильный баланс между получением полезных данных и поддержанием быстродействия сервера. Например, 48 — это вполне оптимальное количество для часов.
— Сохраните настройки.

## Настройка калькулятора
— Теперь, когда соединение с Tibber установлено и работает, вы также можете использовать калькулятор для добавления дополнительных функций автоматизации в адаптер TibberLink.
- Калькулятор работает по каналам, причем каждый канал связан с выбранным домом.
- Эти состояния предназначены для использования в качестве внешних динамических входных данных для TibberLink, позволяя, например, корректировать предельные издержки ("TriggerPrice") из внешнего источника или активировать канал калькулятора ("Active").
— Эти каналы необходимо активировать или деактивировать в зависимости от соответствующего состояния.
- Состояния канала калькулятора расположены рядом с основными состояниями и названы в соответствии с номером канала. При этом здесь отображается название канала, выбранное на экране администратора, для лучшей идентификации ваших настроек.

  ![Состояния калькулятора](../../../en/adapterref/iobroker.tibberlink/docu/calculatorStates.png)

- Поведение каждого канала определяется его типом: «оптимальная стоимость (LTF)», «оптимальное время работы за один час (LTF)», «оптимальное время работы за блок часов (LTF)» или «умный буфер батареи».
- Каждый канал выдает одно или два внешних состояния, которые необходимо выбрать на вкладке настроек. Например, это может быть "0_userdata.0.example_state" или любое другое записываемое внешнее состояние.
- Если внешнее выходное состояние не выбрано, будет создано внутреннее состояние в пределах диапазона канала.
- Значения, которые будут записаны в выходное состояние, могут быть определены как "значение ДА" и "значение НЕТ", например, "истина" для логических состояний или число или текст для записи.
- Выходные данные:
- "Оптимальная стоимость": Использует состояние "Цена срабатывания" в качестве входных данных, выдавая "ДА" каждый час, когда текущая стоимость энергии Tibber ниже цены срабатывания.
- "Лучшие часы": Генерирует вывод "ДА" в течение наименее затратных часов, при этом число определяется в состоянии "AmountHours".
- "Блок оптимального времени": Выводит "ДА" в течение наиболее экономически эффективного блока времени, при этом количество часов указано в состоянии "AmountHours".

Кроме того, средняя общая стоимость в определенном блоке записывается в состояние "AverageTotalCost", расположенное рядом с входными состояниями этого канала. Также в результате вычислений в состояния "BlockStartFullHour" и "BlockEndFullHour" записываются время начала и окончания блока.

- "Лучший процент": Выводит "ДА" в самый дешевый час и в любые другие часы, когда цена попадает в диапазон процентов, указанный в настройках "Процент".
- «Оптимальная стоимость в рамках ограниченного временного периода»: «Оптимальная стоимость» в рамках ограниченного временного периода.
- «Лучшие отдельные часы в рамках ограниченного временного интервала» (LTF): «Лучшие отдельные часы» в рамках ограниченного временного интервала (LTF).
- "Блок лучших часов в рамках ограниченного временного интервала (LTF)": "Блок лучших часов" в рамках ограниченного временного интервала (LTF).
- "Лучший процент в рамках ограниченного временного интервала": "Лучший процент" в рамках ограниченного временного интервала (LTF).
- "Интеллектуальный буфер батареи":
Параметр "EfficiencyLoss" определяет потери эффективности аккумуляторной системы. Его значение варьируется от 0 до 1, где 0 означает отсутствие потерь эффективности, а 1 — полную потерю энергии. Например, значение 0,25 указывает на потерю эффективности в 25% за цикл заряда/разряда.
— Параметр "AmountHours" задает максимальное количество часов, которое система может использовать для зарядки аккумулятора, округленное до четверти часа. Важно: это верхний предел, а не гарантированное количество часов. Фактическое количество временных интервалов зарядки определяется динамически на основе цен на электроэнергию и потерь эффективности. Будут выбраны только те временные интервалы, когда зарядка экономически целесообразна (т.е. цена значительно ниже, чем у самого дорогого интервала, с учетом потерь эффективности).
Калькулятор работает следующим образом:
- Дешевые временные интервалы: зарядка аккумулятора включена (значение ДА), а подача энергии в домашнюю энергосистему отключена (значение 2 НЕТ). Это временные интервалы с самыми низкими ценами, которые проходят фильтр эффективности, до AmountHours.
- Дорогие временные интервалы: зарядка аккумулятора отключена (значение НЕТ), а подача электроэнергии в домашнюю энергосистему включена (значение 2 ДА). В эти интервалы действуют самые высокие цены, превышающие динамически рассчитываемый порог, основанный на ценах самых дешевых временных интервалов и потерях эффективности.
- В обычные временные интервалы: если зарядка экономически нецелесообразна, оба выхода отключаются.
— Такой подход гарантирует, что батарея используется только тогда, когда это экономически выгодно, а не строго по фиксированному количеству часов.
- Каналы LTF: Они работают аналогично стандартным каналам, но активны только в течение временного интервала, определяемого объектами состояния «StartTime» и «StopTime». После «StopTime» канал автоматически деактивируется. «StartTime» и «StopTime» могут охватывать два календарных дня, поскольку Tibber не предоставляет данные за пределами 48-часового окна. В обоих случаях требуется строка даты и времени в формате ISO-8601 со смещением часового пояса, например, '2024-12-24T18:00:00.000+01:00'. Кроме того, каналы LTF имеют новый параметр состояния под названием 'RepeatDays', который по умолчанию равен 0. Если 'RepeatDays' установить в положительное целое число, канал будет повторять свой цикл, увеличивая значения 'StartTime' и 'StopTime' на указанное количество дней после достижения значения 'StopTime'. Например, установите 'RepeatDays' равным 1 для ежедневного повторения.

## Настройка вывода графика
Адаптер помогает визуализировать ценовые тренды и результаты калькулятора. Он предлагает три уровня сложности, каждый из которых предоставляет различные возможности.
Эти три метода предоставляют различные варианты визуализации ценовых трендов и результатов калькулятора. В зависимости от ваших требований вы можете выбрать от простого подхода на основе JSON до полностью настраиваемого решения на JavaScript.

### 1. **(В разработке) Визуализация с использованием адаптера "E-Charts"**
Для этого метода требуется отдельная установка адаптера "E-Charts".

— Можно использовать данные в формате JSON, сгенерированные в разделе «Состояния калькулятора» как `Output-E-Charts`.
— Возможности ограничены особенностями адаптера E-Charts.

### 2. **Использование адаптера "FlexCharts" (или "Fully Featured eCharts") с JSON**
Для этого метода требуется отдельная установка адаптера "FlexCharts".

- Адаптер TibberLink создает состояние с именем `jsonFlexCharts`.

    ![jsonFlexChartsState.png](../../../en/adapterref/iobroker.tibberlink/docu/jsonFlexChartsState.png)

— Адаптер FlexCharts отображает это состояние по следующему URL-адресу:

```
http://[YOUR IP of FLEXCHARTS]:8082/flexcharts/echarts.html?source=state&id=tibberlink.0.Homes.[TIBBER-HOME-ID].PricesTotal.jsonFlexCharts
```

Для получения более подробной информации обратитесь к документации по адаптеру FlexCharts по адресу [https://github.com/MyHomeMyData/ioBroker.flexcharts].

#### **Использование шаблонов JSON**
— Состояние `jsonFlexCharts` генерируется на основе шаблона, настроенного через редактор JSON в параметрах адаптера.
- **Важно:** Встроенный редактор JSON в ioBroker.Admin не поддерживает JSON5, что может привести к ложным сообщениям об ошибках.
— Образец шаблона можно скачать по ссылке: [TemplateFlexChart01.md](docu/TemplateFlexChart01.md).
— Скопируйте и вставьте шаблон в редактор JSON.
- Шаблон содержит заполнители:
- `%%xAxisData%%` и `%%yAxisData%%` (заполняются информацией о ценах во время выполнения).
- `%%CalcChannelsData%%` (заполняется данными выбранного канала калькулятора).
— Остальная часть шаблона соответствует конфигурации Apache ECharts. Для справки см. [Примеры Apache ECharts](https://echarts.apache.org/examples/en/index.html).
- **Рекомендация:** Протестируйте адаптер TibberLink без реального шаблона, используя строку по умолчанию:

```
%%xAxisData%%\n\n%%yAxisData%%\n\n%%CalcChannelsData%%
```

Это помогает понять его функциональность.

— Настройки шаблона можно протестировать на страницах примеров Apache ECharts, используя данные состояния "Output-E-Charts".
— Хорошие шаблоны будут распространены в сообществе разработчиков адаптеров TibberLink.

### 3. **Использование FlexCharts с пользовательским кодом JavaScript**
Для максимальной гибкости и возможности индивидуальной настройки адаптер FlexCharts можно использовать с пользовательским JavaScript.

— Адаптеры "FlexCharts" и "JavaScript" необходимо устанавливать отдельно.
— Такой подход позволяет создавать множество настраиваемых графиков.
— Для получения более подробной информации обратитесь к [обсуждению адаптера FlexCharts](https://github.com/MyHomeMyData/ioBroker.flexcharts/discussions/67).

## Подсказки
### Обратное использование
Чтобы получить, например, часы пик вместо оптимальных часов, просто поменяйте местами использование и параметры: ![Обратные состояния калькулятора](../../../en/adapterref/iobroker.tibberlink/docu/calculatorStatesInverse.png) Поменяв местами true и false, вы получите значение true с низкой стоимостью в первой строке и значение true с высокой стоимостью во второй строке (названия каналов не являются триггерами и по-прежнему могут быть выбраны по вашему усмотрению).

Внимание: Для пиковых часов, как в примере, также необходимо скорректировать количество часов. Исходное значение: 5 -> Обратное значение (24-5) = 19 -> Вы получите истинный результат в течение 5 пиковых часов.

### Каналы LTF
Расчет производится для данных за несколько дней. Поскольку у нас есть информация только за «сегодня» и «завтра» (доступна примерно после 13:00), временной диапазон фактически ограничен максимум 35 часами. Однако крайне важно учитывать это обстоятельство, поскольку рассчитанный результат может/изменится примерно в 13:00, когда станут доступны новые данные о ценах на завтра.

Чтобы наблюдать за этим динамическим изменением временного диапазона для стандартного канала, вы можете выбрать ограниченный временной интервал (LTF), охватывающий несколько лет. Это особенно полезно для сценария «оптимальный LTF для отдельных часов».

## Прямой локальный опрос данных Pulse
Для этого необходимо изменить веб-интерфейс Bridge, чтобы он оставался постоянно включенным.
marq24 отлично описал, как это сделать для своей интеграции с HomeAssistant, здесь:

https://github.com/marq24/ha-tibber-pulse-local

Если всё работает корректно, данные с счётчика будут записываться в состояния ioBroker каждые 2 секунды.

## Часовой
Этот адаптер использует библиотеки Sentry для автоматического сообщения разработчикам об исключениях и ошибках в коде. Для получения более подробной информации и сведений о том, как отключить отправку сообщений об ошибках, обратитесь к разделу [Документация по плагину Sentry](https://github.com/ioBroker/plugin-sentry#plugin-sentry)! Отправка сообщений Sentry начинается с версии js-controller 3.0.

## Пожертвовать
<a href="https://www.paypal.com/donate/?hosted_button_id=F7NM9R2E2DUYS"><img src="https://raw.githubusercontent.com/Hombach/ioBroker.tibberlink/master/docu/bluePayPal.svg" height="40"></a> Если вам понравился этот проект — или вы просто чувствуете себя щедрым, — подумайте о том, чтобы угостить меня пивом. За ваше здоровье! :beers:

## Changelog

<!--
  Placeholder for the next version (at the beginning of the line):
  ### **WORK IN PROGRESS**
-->

### **WORK IN PROGRESS**

- (HombachC) BREAKING: change flexcharts x-axis type
- (HombachC) introduce FlexChart output for SBB channels second output
- (HombachC) introduce second name for FlexChart output of SBB channels
- (HombachC) introduce color for FlexChart output of calculator results
- (HombachC) clean code for 15min time slots
- (HombachC) fix schema links (#822)
- (HombachC) update cron
- (HombachC) update dependencies

### 6.0.3 (2025-11-16)

- (HombachC) optimize sentry
- (HombachC) optimize dependabot config (#805)
- (HombachC) update axios and cron
- (HombachC) update FlexChart template

### 6.0.2 (2025-10-24)

- (HombachC) update NPM deployment
- (HombachC) update dependencies

### 6.0.1 (2025-10-09)

- (HombachC) fix error in cleaning tomorrow data
- (HombachC) update release management to 4.x.x

### 6.0.0 (2025-10-06)

- (HombachC) BREAKING: hourly price states (0...23) are now quarterhourly (0...95)
- (HombachC) BREAKING: adapted calculator time blocks need reentry of "AmountHours" values
- (HombachC) change price updates to 15 minutes resolution as default
- (HombachC) change current price updates to use existing today values instead of Tibber calls
- (HombachC) more timely precision for current price and calculator
- (HombachC) adapt chart generation
- (HombachC) fix error in efficiency loss
- (HombachC) adapt calculator time blocks
- (HombachC) update tibber-api to 5.5.2
- (HombachC) update typescript to 5.9.3 (#777)
- (HombachC) add names to price states folders

### 5.0.4 (2025-09-27)

- (HombachC) prepared price updates to 15 minutes resolution (#384)
- (HombachC) update tibber-api to 5.4.2
- (HombachC) update chai system

### Old Changes see [CHANGELOG OLD](CHANGELOG_OLD.md)

## License

GNU General Public License v3.0 only

Copyright (c) 2023-2025 C.Hombach <TibberLink@homba.ch>