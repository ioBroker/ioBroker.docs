---
title: Мультихост
lastChanged: 13.09.2018
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/config/multihost.md
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
hash: BmBgpKyFgjB7a9BIsAtjjo4dLKC+U95LHDR9PME3eT4=
---
# Многохостовая операция
ioBroker может выполнять задачи на нескольких серверах. Это позволяет распределить вычислительную нагрузку между несколькими хостами.
Но можно также использовать системные расширения одноплатного компьютера (GPIO от Raspberry Pi, хотя «основной компьютер» — более мощный Intel NUC).

После создания мультихостовой системы все настройки выполняются централизованно через админа мастера. С администратором подчиненного устройства больше нельзя связаться через его веб-интерфейс.

Поэтому имеет смысл использовать в качестве слейва хост с минимальной установкой, т. е. только js-контроллер и администратор.

## Установка
### Основная конфигурация
Выполните следующую команду на мастере:

**Этот шаг абсолютно необходим, если используется Redis DB.** В других случаях вы можете использовать его, если автоматический метод (см. ниже) не удался. Тогда выберите f(ile) вместо r(edis)!

Пожалуйста, позвоните через консоль:

1. «Пользовательская настройка iobroker»

Заполните меню, которое теперь выглядит следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[0.0.0.0]:
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[127.0.0.1]: 0.0.0.0
Port of states DB (redis), default[6379]:
Data directory (file), default[../../../iobroker-data/]: /opt/iobroker/iobroker-data/
Host name of this machine [ioBroker-RasPi]:
```

2. `iobroker multihost Enable`

 ` enter pass phrase`

3. `перезапуск iobroker`

### Конфигурация подчиненного устройства
**Этот шаг абсолютно необходим, если используется Redis DB.**

Пожалуйста, войдите через консоль на подчиненном устройстве

1. «Пользовательская настройка iobroker»

Заполните меню, которое теперь выглядит следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[127.0.0.1]: <MASTER-IP>
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[<MASTER-IP>]:
Port of states DB (redis), default[6379]:
Host name of this machine [raspi-sub-1]:
```

Наконец появляется информация:

```
creating conf/iobroker.json
```

2. `iobroker multihost Connect`

и соответственно заполните следующие диалоговые окна:

```
1 |       <MASTER-IP> |  host |       192.168.86.42 | "authentication required"
Please select host [1]: 1
Enter secret phrase for connection: *****

Config ok. Please restart ioBroker: "iobroker restart"
```

2. «перезагрузка iobroker»

Вновь созданный хост появится в разделе «Хосты» в основной системе.

Если этого не произойдет, перезагрузите оба хоста. сначала хозяин, потом раб.

## Мультихост с разными подсетями
Если оба хоста ioBroker находятся в разных подсетях,...

Пример:

* Обычная локальная сеть (для ПК, планшета, использования.) = 192.168.178.0/24
* IoT LAN (для Шелли, камер и т. д.) = 10.20.30.0/24

...автоматический мультихост («iobroker multihost Enable» и «iobroker multihost Browse») не работает, только старый способ (`iobroker setup custom`) см. выше

## Мультихост с Redis
Если необходимо установить многохостовую среду, в которой состояния хранятся в Redis, необходимо принять во внимание несколько вещей.

Файл redis.conf на хосте, где хранятся состояния, необходимо изменить следующим образом.

```
nano /etc/redis/redis.conf
```

Содержащуюся в ней строку `bind 127.0.0.1` необходимо дополнить IP-адресом сетевого адаптера, чтобы сервер Redis разрешал подключения извне.

Так, например.

```
bind 127.0.0.1 192.168.1.10
```

предполагая, что 192.168.1.10 — это локальный IP-адрес мастера ioBroker.

Эта настройка необходима только на мастере.

Альтернативно тоже возможно

```
bind 0.0.0.0
```

В Redis версии 7 вам также необходимо отключить защищенный режим. Для этого вам нужно использовать строку

```
protected-mode yes
```

на

```
protected-mode no
```

изменять.

Наконец, перезагрузите сервер или компьютер Redis. например.:

```
sudo service redis-server restart
```

## Распределяем задачи
Существует два способа распределения задач между хостами.

* Если это новая установка, выберите хост, на котором должен быть установлен экземпляр адаптера, из раскрывающегося меню над списком адаптеров на вкладке Адаптер.

Затем добавьте туда экземпляр, нажав на (+) в правом столбце.

* Если вы уже установили на хост множество адаптеров, вы можете впоследствии изменить назначение уже установленных экземпляров на вкладке «Экземпляры».

## Удалить хост
Чтобы удалить хост, активируйте экспертный режим на вкладке администратора «Объекты» мастера и активируйте выбор хоста в столбце «Тип». Затем удалите нужный хост.

## Возможные проблемы
Иногда появляется сообщение, похожее на:

`> ... bytes ... in strict mode`

Затем отредактируйте файл, в котором это происходит, с помощью редактора nano. В самом начале есть `'use strict';`, прокомментируйте эту строку // и сохраните.

`> IP Address of the host is 127.0.0.1. It accepts no connections. Please change.`

если вы не выполнили ``` setup custom ``` в главной системе.